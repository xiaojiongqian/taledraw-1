# ğŸ“‹ **Tale Draw - AIç»˜æœ¬ç”Ÿæˆå™¨**

# ğŸ“š Tale Draw - å¼€å‘è®¡åˆ’æ–‡æ¡£

## é¡¹ç›®æ¦‚è¿°

åŸºäºGeminiå’ŒImagen 4 APIå¼€å‘çš„è‡ªåŠ¨ç»˜åˆ¶æ•…äº‹ä¹¦Reactåº”ç”¨ã€‚ç”¨æˆ·è¾“å…¥æ•…äº‹æ–‡æœ¬ï¼Œç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆå¤šé¡µæ’å›¾æ•…äº‹ä¹¦ã€‚

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½éœ€æ±‚

### åŸºç¡€åŠŸèƒ½
- [x] ç”¨æˆ·æ•…äº‹æ–‡æœ¬è¾“å…¥
- [x] ä½¿ç”¨Geminiç”Ÿæˆå›¾åƒæç¤ºè¯ï¼ˆJSONæ ¼å¼ï¼‰
- [x] ä½¿ç”¨Imagen 4ç”Ÿæˆæ¯é¡µæ’å›¾
- [x] å¯æ»šåŠ¨çš„æ•…äº‹ä¹¦å±•ç¤ºç•Œé¢
- [x] ç”¨æˆ·å¯é…ç½®é¡µæ•°ï¼ˆé»˜è®¤7é¡µï¼‰
- [x] å›¾ç‰‡é•¿å®½æ¯”é€‰æ‹©ï¼ˆ16:9/9:16ï¼‰
- [x] **çŠ¶æ€æŒä¹…åŒ–åŠŸèƒ½**ï¼ˆåˆ·æ–°é¡µé¢åè‡ªåŠ¨æ¢å¤ç»˜æœ¬çŠ¶æ€ï¼‰
- [ ] å¤šè¯­è¨€æ”¯æŒï¼ˆä¸è¾“å…¥æ–‡æœ¬ç›¸åŒè¯­è¨€ï¼‰

### è§’è‰²ä¸€è‡´æ€§åŠŸèƒ½
- [ ] è§’è‰²æ™ºèƒ½æå–ç³»ç»Ÿï¼ˆè‡ªåŠ¨ä»æ•…äº‹ä¸­è¯†åˆ«è§’è‰²ï¼‰
- [ ] è§’è‰²æ‰‹åŠ¨è¾“å…¥ç³»ç»Ÿï¼ˆç”¨æˆ·è‡ªå®šä¹‰è§’è‰²ï¼‰
- [ ] è§’è‰²å¤–è§‚ä¸€è‡´æ€§ä¿æŒ
- [ ] è§’è‰²å‚è€ƒå›¾ç‰‡ä¸Šä¼ ï¼ˆå¯é€‰ï¼‰
- [ ] åŸºäºå‚è€ƒå›¾ç‰‡çš„å›¾åƒç”Ÿæˆ

### æŠ€æœ¯æ¶æ„
- [x] Reactå•é¡µåº”ç”¨
- [x] Firebase Authenticationï¼ˆé‚®ç®±/å¯†ç ï¼‰
- [x] Firebase Storageå›¾åƒå­˜å‚¨
- [x] Firebase Functionsä½œä¸ºAPIä»£ç†
- [x] æœ€æ–°Imagen 4 APIé›†æˆ

---

## ğŸ—ï¸ å¼€å‘é˜¶æ®µè§„åˆ’

## Phase 1: åŸºç¡€æ¶æ„å®Œå–„ âœ…

### 1.1 é¡¹ç›®åˆå§‹åŒ–
- [x] Reactåº”ç”¨æ­å»º
- [x] Firebaseé¡¹ç›®é…ç½®
- [x] ç¯å¢ƒå˜é‡è®¾ç½®
- [x] ä¾èµ–åŒ…å®‰è£…

### 1.2 Firebaseé›†æˆ
- [x] Firebase SDKé…ç½®
- [x] Authenticationç³»ç»Ÿå®ç°
- [x] Storageé…ç½®
- [x] Functionséƒ¨ç½²

### 1.3 APIé›†æˆ
- [x] Gemini APIæ¥å…¥
- [x] Imagen 4 APIæ¥å…¥
- [x] CORSé—®é¢˜è§£å†³
- [x] é”™è¯¯å¤„ç†æœºåˆ¶

**çŠ¶æ€**: âœ… å·²å®Œæˆ

---

## Phase 1.5: çŠ¶æ€æŒä¹…åŒ–ç³»ç»Ÿ âœ…

### 1.5.1 çŠ¶æ€ç®¡ç†æ¶æ„
- [x] **StateManager ç±»å®ç°**
  - âœ… localStorage åŸºç¡€å­˜å‚¨
  - âœ… çŠ¶æ€æ•°æ®ç‰ˆæœ¬æ§åˆ¶
  - âœ… æ•°æ®è¿‡æœŸæœºåˆ¶ï¼ˆ24å°æ—¶ï¼‰
  - âœ… ç”¨æˆ·çŠ¶æ€éš”ç¦»

- [x] **çŠ¶æ€æ•°æ®ç»“æ„è®¾è®¡**
  ```javascript
  {
    version: "1.0.0",
    timestamp: Date.now(),
    userEmail: "user@example.com",
    story: "æ•…äº‹å†…å®¹",
    storyTitle: "æ•…äº‹æ ‡é¢˜",
    pageCount: 10,
    aspectRatio: "16:9",
    artStyle: "å„¿ç«¥ç»˜æœ¬æ’ç”»é£æ ¼",
    allCharacters: {},
    pages: [],
    hasGeneratedContent: true
  }
  ```

### 1.5.2 è‡ªåŠ¨çŠ¶æ€ä¿å­˜æœºåˆ¶
- [x] **å…³é”®èŠ‚ç‚¹è‡ªåŠ¨ä¿å­˜**
  - âœ… æ•…äº‹ç”Ÿæˆå®Œæˆåä¿å­˜
  - âœ… å›¾ç‰‡ç”Ÿæˆå®Œæˆåä¿å­˜
  - âœ… é‡æ–°ç”Ÿæˆå›¾ç‰‡åä¿å­˜
  - âœ… ç¼–è¾‘æ ‡é¢˜åä¿å­˜

- [x] **çŠ¶æ€æ¸…ç†æœºåˆ¶**
  - âœ… ç”¨æˆ·é€€å‡ºç™»å½•æ—¶æ¸…ç†
  - âœ… æ¸…é™¤æ•…äº‹æ—¶æ¸…ç†
  - âœ… ç‰ˆæœ¬ä¸å…¼å®¹æ—¶æ¸…ç†

### 1.5.3 çŠ¶æ€æ¢å¤ç³»ç»Ÿ
- [x] **æ™ºèƒ½æ¢å¤æµç¨‹**
  - âœ… ç”¨æˆ·ç™»å½•åè‡ªåŠ¨æ£€æµ‹
  - âœ… æ•°æ®æœ‰æ•ˆæ€§éªŒè¯
  - âœ… ç”¨æˆ·èº«ä»½åŒ¹é…æ£€æŸ¥
  - âœ… åŸºæœ¬çŠ¶æ€æ¢å¤

- [x] **å›¾ç‰‡é‡æ–°ä¸‹è½½**
  - âœ… è‡ªåŠ¨é‡æ–°ä¸‹è½½æ‰€æœ‰å›¾ç‰‡
  - âœ… å®æ—¶æ˜¾ç¤ºä¸‹è½½è¿›åº¦
  - âœ… å¤±è´¥çŠ¶æ€æ ‡è®°
  - âœ… æ”¯æŒåç»­é‡æ–°ç”Ÿæˆ

### 1.5.4 ç”¨æˆ·ä½“éªŒä¼˜åŒ–
- [x] **æ¢å¤è¿‡ç¨‹UI**
  - âœ… å‹å¥½çš„è¿›åº¦æç¤º
  - âœ… æ¢å¤çŠ¶æ€æŒ‡ç¤ºå™¨
  - âœ… æˆåŠŸ/å¤±è´¥æ¶ˆæ¯æ˜¾ç¤º
  - âœ… ä¸ç”ŸæˆçŠ¶æ€çš„UIåŒºåˆ†

- [x] **å®‰å…¨æ€§ä¿éšœ**
  - âœ… ä¸åŒç”¨æˆ·çŠ¶æ€éš”ç¦»
  - âœ… æ•°æ®ç‰ˆæœ¬å…¼å®¹æ€§æ£€æŸ¥
  - âœ… è‡ªåŠ¨æ¸…ç†è¿‡æœŸæ•°æ®
  - âœ… é”™è¯¯å¤„ç†å’Œæ¢å¤

**åŠŸèƒ½ç‰¹ç‚¹**:
- ğŸ”„ é¡µé¢åˆ·æ–°åè‡ªåŠ¨æ¢å¤ç»˜æœ¬çŠ¶æ€
- ğŸ–¼ï¸ è‡ªåŠ¨é‡æ–°ä¸‹è½½å›¾ç‰‡ï¼ˆéé‡æ–°ç”Ÿæˆï¼‰
- ğŸ‘¥ ç”¨æˆ·çŠ¶æ€éš”ç¦»å’Œéšç§ä¿æŠ¤
- â° 24å°æ—¶æ•°æ®æœ‰æ•ˆæœŸ
- ğŸ”§ ç‰ˆæœ¬å…¼å®¹æ€§ç®¡ç†

**çŠ¶æ€**: âœ… å·²å®Œæˆ

---

## Phase 2: UIç•Œé¢å¢å¼º âœ…

### 2.1 è¾“å…¥ç•Œé¢ä¼˜åŒ–
- [x] **é¡µæ•°é€‰æ‹©å™¨ç»„ä»¶**
  - âœ… æ»‘å—æˆ–æ•°å­—è¾“å…¥æ¡†
  - âœ… èŒƒå›´ï¼š1-30é¡µ
  - âœ… é»˜è®¤å€¼ï¼š7é¡µ
  - âœ… æ™ºèƒ½é¡µæ•°å»ºè®®æç¤º
  
- [x] **å›¾ç‰‡è®¾ç½®åŒºåŸŸ**
  - âœ… é•¿å®½æ¯”é€‰æ‹©å™¨ç»„ä»¶ï¼ˆ16:9 / 9:16åˆ‡æ¢ï¼Œé»˜è®¤16:9ï¼‰
  - âœ… å®æ—¶é¢„è§ˆä¸åŒæ¯”ä¾‹çš„æ•ˆæœç¤ºæ„
  - âœ… é€‚é…ç§»åŠ¨ç«¯æ˜¾ç¤ºä¼˜åŒ–
  - âœ… ä¸Imagen 4 APIå‚æ•°å¯¹æ¥
  
- [ ] **è§’è‰²ç®¡ç†åŒºåŸŸ**
  - è§’è‰²æå–æ¨¡å¼é€‰æ‹©ï¼ˆè‡ªåŠ¨æå– / æ‰‹åŠ¨è¾“å…¥ï¼‰
  - è‡ªåŠ¨æå–ï¼šæ˜¾ç¤ºè¯†åˆ«å‡ºçš„è§’è‰²åˆ—è¡¨ï¼Œå…è®¸ç¼–è¾‘
  - æ‰‹åŠ¨è¾“å…¥ï¼šè§’è‰²åç§°ã€æè¿°ã€è§’è‰²å‚è€ƒå›¾ç‰‡ä¸Šä¼ 
  - è§’è‰²é¢„è§ˆå’Œç¼–è¾‘åŠŸèƒ½

### 2.2 è¡¨å•ç»“æ„é‡æ„
```jsx
// æ–°çš„è¾“å…¥æ•°æ®ç»“æ„
{
      storyText: string,           // æ•…äº‹å†…å®¹ï¼ˆæœ€å¤§2000å­—ï¼‰
    pageCount: number,           // é¡µæ•°ï¼ˆ1-30ï¼Œé»˜è®¤6ï¼‰
  aspectRatio: string,         // å›¾ç‰‡é•¿å®½æ¯”ï¼š"16:9" | "9:16"ï¼Œé»˜è®¤"16:9"
  language: string,            // è‡ªåŠ¨æ£€æµ‹è¾“å…¥è¯­è¨€
  characterMode: string,       // è§’è‰²æ¨¡å¼ï¼š"auto" | "manual"
  characters: [                // è§’è‰²ä¿¡æ¯æ•°ç»„
    {
      id: string,              // è§’è‰²å”¯ä¸€ID
      name: string,            // è§’è‰²åç§°
      description: string,     // è§’è‰²æè¿°
      isAutoGenerated: boolean, // æ˜¯å¦è‡ªåŠ¨ç”Ÿæˆ
      referenceImage: File,    // è§’è‰²å‚è€ƒå›¾ç‰‡ï¼ˆå¯é€‰ï¼‰
      seed: number             // è§’è‰²ä¸€è‡´æ€§ç§å­å€¼
    }
  ]
}
```

### 2.3 UI/UXæ”¹è¿›
- [ ] å“åº”å¼è®¾è®¡ä¼˜åŒ–
- [ ] åŠ è½½åŠ¨ç”»å’Œè¿›åº¦æŒ‡ç¤ºå™¨
- [ ] é”™è¯¯æç¤ºä¼˜åŒ–
- [ ] å¤šè¯­è¨€ç•Œé¢æ”¯æŒ

**é¢„è®¡æ—¶é—´**: 2-3å¤©

---

## Phase 2.5: è§’è‰²æ™ºèƒ½ç³»ç»Ÿ ğŸ­

### 2.5.1 è§’è‰²æå–ç®—æ³•
- [ ] **Geminiè§’è‰²è¯†åˆ«API**
  ```javascript
  // è§’è‰²æå–æœåŠ¡
  async function extractCharacters(storyText, language) {
    const prompt = `
    åˆ†æä»¥ä¸‹æ•…äº‹ï¼Œæå–ä¸»è¦è§’è‰²ä¿¡æ¯ï¼š
    æ•…äº‹ï¼š${storyText}
    
    è¦æ±‚ï¼š
    1. è¯†åˆ«2-5ä¸ªä¸»è¦è§’è‰²
    2. ä¸ºæ¯ä¸ªè§’è‰²ç”Ÿæˆè¯¦ç»†å¤–è§‚æè¿°
    3. åŒ…å«å¹´é¾„ã€æ€§åˆ«ã€å¤–è²Œç‰¹å¾ã€æœè£…ç­‰
    4. ç¡®ä¿æè¿°ä¸€è‡´æ€§å’Œå¯è§†åŒ–
    
    è¿”å›JSONï¼š
    {
      "characters": [
        {
          "name": "è§’è‰²å",
          "description": "è¯¦ç»†å¤–è§‚æè¿°",
          "traits": ["ç‰¹å¾1", "ç‰¹å¾2"],
          "age": "å¹´é¾„ç»„",
          "role": "æ•…äº‹è§’è‰²"
        }
      ]
    }
    `;
  }
  ```

### 2.5.2 è§’è‰²ç®¡ç†ç•Œé¢
- [ ] **æ¨¡å¼é€‰æ‹©ç»„ä»¶**
  - è‡ªåŠ¨æå– vs æ‰‹åŠ¨è¾“å…¥åˆ‡æ¢
  - é¢„è§ˆæå–ç»“æœ
  - ç¼–è¾‘å’Œç¡®è®¤åŠŸèƒ½

- [ ] **è§’è‰²ç¼–è¾‘å™¨**
  - è§’è‰²å¡ç‰‡å±•ç¤º
  - åœ¨çº¿ç¼–è¾‘æè¿°
  - å‚è€ƒå›¾ç‰‡ä¸Šä¼ 
  - ä¸€è‡´æ€§é¢„è§ˆ

### 2.5.3 è§’è‰²ä¸€è‡´æ€§ç®—æ³•
- [ ] **ç§å­å€¼ç”Ÿæˆ**
  ```javascript
  // ä¸ºæ¯ä¸ªè§’è‰²ç”Ÿæˆå”¯ä¸€ä½†ç¨³å®šçš„ç§å­å€¼
  function generateCharacterSeed(characterName, traits) {
    const hash = cyrb53(characterName + traits.join(''));
    return Math.abs(hash) % 1000000;
  }
  ```

- [ ] **æç¤ºè¯å¢å¼º**
  ```javascript
  // è§’è‰²ä¸€è‡´æ€§æç¤ºè¯æ„å»ºå™¨
  function buildCharacterPrompt(character, scene, pageNumber) {
    return `
    è§’è‰²ï¼š${character.name}
    å¤–è§‚ï¼š${character.description}
    ç‰¹å¾ï¼š${character.traits.join(', ')}
    åœºæ™¯ï¼š${scene}
    ç§å­å€¼ï¼š${character.seed}
    é£æ ¼ï¼šå„¿ç«¥ç»˜æœ¬æ’å›¾ï¼Œä¸€è‡´æ€§è§’è‰²è®¾è®¡
    `;
  }
  ```

**é¢„è®¡æ—¶é—´**: 3-4å¤©

---

## Phase 2.6: å†…å®¹å®‰å…¨ä¼˜åŒ– âœ…

### 2.6.1 LLMå±‚é¢çš„å®‰å…¨æŒ‡å¯¼
- [x] **Geminiæ•…äº‹åˆ†é¡µAPIå®‰å…¨æŒ‡å¯¼**
  - âœ… æš´åŠ›åœºæ™¯è½¬æ¢ä¸ºå‹å¥½ç«èµ›
  - âœ… ææ€–å…ƒç´ è½¬åŒ–ä¸ºç¥ç§˜æ¢é™©  
  - âœ… è´Ÿé¢æƒ…ç»ªè½¬åŒ–ä¸ºæ¸©å’Œè¡¨è¾¾
  - âœ… å±é™©è¡Œä¸ºè½¬åŒ–ä¸ºå®‰å…¨æ¢ç´¢
  - âœ… åŒ…å®¹æ€§è¯­è¨€æè¿°æŒ‡å¯¼

- [x] **è§’è‰²æå–APIå®‰å…¨æŒ‡å¯¼**
  - âœ… é¿å…åˆ»æ¿å°è±¡ç‰¹å¾æè¿°
  - âœ… è´Ÿé¢ç‰¹å¾è½¬åŒ–ä¸ºæ­£é¢æè¿°
  - âœ… å¼ºè°ƒå‹å–„æ¸©å’Œè¡¨æƒ…
  - âœ… å„¿ç«¥é€‚å®œçš„æœè£…é…é¥°
  - âœ… å¤šå…ƒåŒ–åŒ…å®¹æ€§æè¿°

### 2.6.2 å‰ç«¯å®‰å…¨å¤„ç†
- [x] **ç”¨æˆ·æç¤ºè¯å®æ—¶è½¬æ¢**
  ```javascript
  // å®‰å…¨è¯æ±‡æ˜ å°„ç³»ç»Ÿ
  'æ‰“æ¶' -> 'ç©è€'
  'æˆ˜æ–—' -> 'å‹å¥½ç«èµ›'  
  'ææ€–' -> 'æœ‰è¶£'
  'é‚ªæ¶' -> 'è°ƒçš®'
  'å±é™©' -> 'å†’é™©'
  ```

- [x] **ç”¨æˆ·ç•Œé¢å®‰å…¨æç¤º**
  - âœ… æç¤ºè¯ç¼–è¾‘å™¨å®‰å…¨æŒ‡å¯¼
  - âœ… å‹å–„è¯æ±‡ä½¿ç”¨ç¤ºä¾‹
  - âœ… è‡ªåŠ¨ä¼˜åŒ–æé†’æœºåˆ¶

### 2.6.3 å›¾åƒç”Ÿæˆå®‰å…¨å¢å¼º
- [x] **è‡ªåŠ¨å®‰å…¨æè¿°æ·»åŠ **
  ```
  'Safe and welcoming atmosphere, friendly expressions, suitable for children.'
  ```

- [x] **æ›´æ–°çš„å®‰å…¨ç»“æŸè¯­**
  ```
  'warm and friendly colors, safe and welcoming atmosphere'
  ```

### 2.6.4 å¤šå±‚çº§å®‰å…¨ä¿æŠ¤
- [x] **å››å±‚å®‰å…¨æ£€æŸ¥**
  1. æ•…äº‹è¾“å…¥é˜¶æ®µ - Geminiå®‰å…¨æŒ‡å¯¼
  2. å›¾ç‰‡ç”Ÿæˆé˜¶æ®µ - è‡ªåŠ¨å®‰å…¨ä¼˜åŒ–
  3. ç”¨æˆ·ç¼–è¾‘é˜¶æ®µ - å®æ—¶è¯æ±‡è½¬æ¢  
  4. æœ€ç»ˆç”Ÿæˆé˜¶æ®µ - å®‰å…¨æ°›å›´æ·»åŠ 

**çŠ¶æ€**: âœ… å·²å®Œæˆ
**æ–‡æ¡£**: è¯¦è§ `CONTENT_SAFETY.md`

---

## Phase 3: åç«¯APIå¢å¼º ğŸ”„

### 3.1 Gemini APIå‡çº§
- [ ] **è§’è‰²æå–API**
  ```javascript
  const characterExtractionPrompt = `
  è¯·ä»ä»¥ä¸‹æ•…äº‹ä¸­æå–ä¸»è¦è§’è‰²ä¿¡æ¯ï¼š
  
  æ•…äº‹å†…å®¹ï¼š${storyText}
  
  è¦æ±‚ï¼š
  1. è¯†åˆ«æ‰€æœ‰ä¸»è¦è§’è‰²
  2. ä¸ºæ¯ä¸ªè§’è‰²ç”Ÿæˆè¯¦ç»†çš„å¤–è§‚æè¿°
  3. ç¡®ä¿æè¿°è¶³å¤Ÿè¯¦ç»†ä»¥ä¿æŒè§†è§‰ä¸€è‡´æ€§
  4. ä½¿ç”¨${language}è¯­è¨€
  
  è¿”å›JSONæ ¼å¼çš„è§’è‰²åˆ—è¡¨...
  `;
  ```

- [ ] **æ•…äº‹åˆ†é¡µAPI**
  ```javascript
  const storyPaginationPrompt = `
  è¯·å°†ä»¥ä¸‹æ•…äº‹åˆ†è§£ä¸º${pageCount}é¡µçš„å„¿ç«¥ç»˜æœ¬ï¼š
  
  æ•…äº‹å†…å®¹ï¼š${storyText}
  è§’è‰²ä¿¡æ¯ï¼š${charactersInfo}
  
  è¦æ±‚ï¼š
  1. æ¯é¡µåŒ…å«é€‚é‡æ–‡æœ¬ï¼ˆé€‚åˆå„¿ç«¥é˜…è¯»ï¼‰
  2. ç”Ÿæˆè¯¦ç»†çš„å›¾åƒæè¿°
  3. ä¿æŒè§’è‰²å¤–è§‚ä¸€è‡´æ€§
  4. ä½¿ç”¨${language}è¯­è¨€
  
  è¿”å›JSONæ ¼å¼...
  `;
  ```

- [ ] **JSONå“åº”æ ¼å¼ä¼˜åŒ–**
  ```json
  {
    "totalPages": 10,
    "language": "zh-CN",
    "characters": {
      "å°çŒ«å’ªå’ª": {
        "description": "ç©¿çº¢è£™å­çš„å¯çˆ±å°çŒ«",
        "traits": ["çº¢è‰²è£™å­", "å¤§çœ¼ç›", "ç™½è‰²æ¯›å‘"]
      }
    },
    "pages": [
      {
        "pageNumber": 1,
        "text": "æ•…äº‹æ–‡æœ¬",
        "imagePrompt": "è¯¦ç»†å›¾åƒæè¿°",
        "characters": ["å°çŒ«å’ªå’ª"],
        "scene": "èŠ±å›­",
        "mood": "å¼€å¿ƒ"
      }
    ]
  }
  ```

### 3.2 Imagen 4 APIå¢å¼º
- [ ] **å‚è€ƒå›¾ç‰‡æ”¯æŒ**
  ```javascript
  // æ”¯æŒå‚è€ƒå›¾ç‰‡å’ŒåŠ¨æ€é•¿å®½æ¯”çš„APIè°ƒç”¨
  const requestBody = {
    instances: [{
      prompt: enhancedPrompt,
      image: referenceImageBase64 // æ–°å¢ï¼šå‚è€ƒå›¾ç‰‡
    }],
    parameters: {
      sampleCount: 1,
      aspectRatio: userAspectRatio, // ç”¨æˆ·é€‰æ‹©çš„é•¿å®½æ¯”ï¼š"16:9" | "9:16"
      seed: characterSeed, // è§’è‰²ä¸€è‡´æ€§ç§å­
      addWatermark: false,
      referenceImageConfig: {
        referenceType: "SUBJECT" // å‚è€ƒç±»å‹ï¼šSUBJECTæˆ–STYLE
      }
    }
  };
  ```

- [ ] **é•¿å®½æ¯”é€‚é…ä¼˜åŒ–**
  ```javascript
  // æ ¹æ®é•¿å®½æ¯”ä¼˜åŒ–æç¤ºè¯
  function optimizePromptForAspectRatio(basePrompt, aspectRatio) {
    const aspectRatioHints = {
      "16:9": "horizontal composition, landscape orientation, wide scene",
      "9:16": "vertical composition, portrait orientation, tall scene"
    };
    
    return `${basePrompt}. ${aspectRatioHints[aspectRatio]}, children's book illustration style.`;
  }
  ```

### 3.3 Firebase Functionsæ›´æ–°
- [ ] å‚è€ƒå›¾ç‰‡å¤„ç†å‡½æ•°
- [ ] è§’è‰²ä¸€è‡´æ€§ç®—æ³•
- [ ] é•¿å®½æ¯”å‚æ•°ä¼ é€’å’Œå¤„ç†
- [ ] æ‰¹é‡å›¾åƒç”Ÿæˆä¼˜åŒ–
- [ ] ä¸åŒæ¯”ä¾‹çš„å›¾åƒè´¨é‡ä¼˜åŒ–

**é¢„è®¡æ—¶é—´**: 3-4å¤©

---

## Phase 4: è§’è‰²ä¸€è‡´æ€§ç³»ç»Ÿ ğŸ­

### 4.1 è§’è‰²ç®¡ç†å™¨
```javascript
class CharacterManager {
  constructor(characters) {
    this.characters = characters;
    this.seeds = new Map(); // è§’è‰²ç§å­å€¼
    this.referenceImages = new Map(); // å‚è€ƒå›¾ç‰‡
  }
  
  // ä¸Šä¼ è§’è‰²å‚è€ƒå›¾ç‰‡
  async uploadReferenceImages() { }
  
  // ç”Ÿæˆè§’è‰²ä¸€è‡´æ€§æç¤ºè¯
  getCharacterPrompt(characterName, scene) { }
  
  // è·å–è§’è‰²ä¸“ç”¨ç§å­å€¼
  getCharacterSeed(characterName) { }
}
```

### 4.2 æç¤ºè¯å¢å¼ºç³»ç»Ÿ
- [ ] **è§’è‰²å¤–è§‚æè¿°ç”Ÿæˆå™¨**
- [ ] **åœºæ™¯ä¸è§’è‰²ç»“åˆç®—æ³•**
- [ ] **é£æ ¼ä¸€è‡´æ€§ä¿æŒæœºåˆ¶**

### 4.3 å›¾åƒè´¨é‡ä¼˜åŒ–
- [ ] å‚è€ƒå›¾ç‰‡é¢„å¤„ç†
- [ ] æç¤ºè¯ä¼˜åŒ–ç®—æ³•
- [ ] ç”Ÿæˆç»“æœè´¨é‡è¯„ä¼°

**é¢„è®¡æ—¶é—´**: 4-5å¤©

---

## Phase 5: ç”¨æˆ·ä½“éªŒä¼˜åŒ– âœ¨

### 5.1 ç”Ÿæˆæµç¨‹ä¼˜åŒ–
- [ ] **æ™ºèƒ½é¡µæ•°å»ºè®®**ï¼ˆæ ¹æ®æ•…äº‹é•¿åº¦ï¼‰
- [ ] **å®æ—¶ç”Ÿæˆé¢„è§ˆ**
- [ ] **ç”Ÿæˆè¿›åº¦å¯è§†åŒ–**
- [ ] **é”™è¯¯é‡è¯•æœºåˆ¶**

### 5.2 å¤šè¯­è¨€æ”¯æŒ
- [ ] **è‡ªåŠ¨è¯­è¨€æ£€æµ‹**
- [ ] **å¤šè¯­è¨€æç¤ºè¯æ¨¡æ¿**
- [ ] **ç•Œé¢å¤šè¯­è¨€åˆ‡æ¢**

### 5.3 å­˜å‚¨å’Œåˆ†äº«
- [ ] **æ•…äº‹ä¹¦ä¿å­˜åŠŸèƒ½**
- [ ] **PDFå¯¼å‡ºåŠŸèƒ½**
- [ ] **ç¤¾äº¤åˆ†äº«é›†æˆ**
- [ ] **å†å²è®°å½•ç®¡ç†**

**é¢„è®¡æ—¶é—´**: 3-4å¤©

---

## Phase 6: æµ‹è¯•å’Œéƒ¨ç½² ğŸš€

### 6.1 åŠŸèƒ½æµ‹è¯•
- [ ] å•å…ƒæµ‹è¯•ç¼–å†™
- [ ] é›†æˆæµ‹è¯•
- [ ] ç”¨æˆ·ä½“éªŒæµ‹è¯•
- [ ] æ€§èƒ½æµ‹è¯•

### 6.2 ä¼˜åŒ–å’Œè°ƒè¯•
- [ ] APIè°ƒç”¨ä¼˜åŒ–
- [ ] å›¾åƒåŠ è½½æ€§èƒ½ä¼˜åŒ–
- [ ] é”™è¯¯å¤„ç†å®Œå–„
- [ ] ç”¨æˆ·åé¦ˆæ”¶é›†

### 6.3 éƒ¨ç½²ä¸Šçº¿
- [ ] ç”Ÿäº§ç¯å¢ƒé…ç½®
- [ ] Firebase Hostingéƒ¨ç½²
- [ ] åŸŸåå’ŒSSLé…ç½®
- [ ] ç›‘æ§å’Œæ—¥å¿—é…ç½®

**é¢„è®¡æ—¶é—´**: 2-3å¤©

---

## ğŸ“Š æŠ€æœ¯å®ç°ç»†èŠ‚

### æ ¸å¿ƒç»„ä»¶æ¶æ„
```
src/
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ StoryInput.js          // æ•…äº‹è¾“å…¥ç»„ä»¶
â”‚   â”œâ”€â”€ PageSelector.js        // é¡µæ•°é€‰æ‹©å™¨ï¼ˆæ–°å¢ï¼‰
â”‚   â”œâ”€â”€ AspectRatioSelector.js // é•¿å®½æ¯”é€‰æ‹©å™¨ï¼ˆæ–°å¢ï¼‰
â”‚   â”œâ”€â”€ CharacterManager.js    // è§’è‰²ç®¡ç†å™¨ï¼ˆæ–°å¢ï¼‰
â”‚   â”œâ”€â”€ CharacterExtractor.js  // è‡ªåŠ¨è§’è‰²æå–ï¼ˆæ–°å¢ï¼‰
â”‚   â”œâ”€â”€ CharacterEditor.js     // è§’è‰²ç¼–è¾‘å™¨ï¼ˆæ–°å¢ï¼‰
â”‚   â”œâ”€â”€ StoryBook.js           // æ•…äº‹ä¹¦å±•ç¤º
â”‚   â””â”€â”€ ProgressIndicator.js   // è¿›åº¦æŒ‡ç¤ºå™¨
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ geminiService.js       // Gemini APIæœåŠ¡
â”‚   â”œâ”€â”€ imagenService.js       // Imagen 4 APIæœåŠ¡
â”‚   â”œâ”€â”€ characterService.js    // è§’è‰²ç®¡ç†æœåŠ¡ï¼ˆæ–°å¢ï¼‰
â”‚   â””â”€â”€ storageService.js      // å­˜å‚¨æœåŠ¡
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ languageDetector.js    // è¯­è¨€æ£€æµ‹ï¼ˆæ–°å¢ï¼‰
â”‚   â”œâ”€â”€ promptBuilder.js       // æç¤ºè¯æ„å»ºå™¨ï¼ˆæ–°å¢ï¼‰
â”‚   â””â”€â”€ imageProcessor.js      // å›¾åƒå¤„ç†ï¼ˆæ–°å¢ï¼‰
â””â”€â”€ hooks/
    â”œâ”€â”€ useCharacterManager.js // è§’è‰²ç®¡ç†Hookï¼ˆæ–°å¢ï¼‰
    â””â”€â”€ useStoryGeneration.js  // æ•…äº‹ç”ŸæˆHook
```

### APIè°ƒç”¨æµç¨‹
```mermaid
graph TD
    A[ç”¨æˆ·è¾“å…¥] --> B[å‚æ•°è®¾ç½®]
    B --> B1[é¡µæ•°é€‰æ‹©:1-30]
    B --> B2[é•¿å®½æ¯”é€‰æ‹©:16:9/9:16]
    B --> B3[è¯­è¨€æ£€æµ‹]
    B1 --> C{è§’è‰²æ¨¡å¼é€‰æ‹©}
    B2 --> C
    B3 --> C
    C -->|è‡ªåŠ¨æå–| D[Geminiè§’è‰²æå–]
    C -->|æ‰‹åŠ¨è¾“å…¥| E[ç”¨æˆ·è§’è‰²ç¼–è¾‘]
    D --> F[è§’è‰²ç¡®è®¤/ç¼–è¾‘]
    E --> F
    F --> G[è§’è‰²å‚è€ƒå›¾ç‰‡ä¸Šä¼ ]
    G --> H[Geminiæ•…äº‹åˆ†é¡µ]
    H --> I[Imagenå›¾åƒç”Ÿæˆ+é•¿å®½æ¯”é€‚é…]
    I --> J[ç»“æœå±•ç¤º]
```

---

## ğŸ¯ å½“å‰ä¼˜å…ˆçº§

### ğŸ”¥ é«˜ä¼˜å…ˆçº§ï¼ˆç«‹å³å¼€å§‹ï¼‰
1. âœ… **é¡µæ•°é€‰æ‹©å™¨å®ç°**ï¼ˆ1-30é¡µï¼Œé»˜è®¤6é¡µï¼‰
2. âœ… **é•¿å®½æ¯”é€‰æ‹©å™¨å®ç°**ï¼ˆ16:9/9:16ï¼Œé»˜è®¤16:9ï¼‰
3. **è§’è‰²ç®¡ç†ç³»ç»Ÿè®¾è®¡**
4. **è§’è‰²æå–vsæ‰‹åŠ¨è¾“å…¥UI**
5. **Geminiè§’è‰²æå–API**

### âš¡ ä¸­ä¼˜å…ˆçº§ï¼ˆæœ¬å‘¨å®Œæˆï¼‰
1. **å‚è€ƒå›¾ç‰‡ä¸Šä¼ åŠŸèƒ½**
2. **è§’è‰²ä¸€è‡´æ€§ç®—æ³•**
3. **å¤šè¯­è¨€æ”¯æŒ**

### ğŸ’¡ ä½ä¼˜å…ˆçº§ï¼ˆä¸‹å‘¨è®¡åˆ’ï¼‰
1. **é«˜çº§UIä¼˜åŒ–**
2. **å¯¼å‡ºåˆ†äº«åŠŸèƒ½**
3. **æ€§èƒ½ä¼˜åŒ–**

---

## ğŸ“ˆ æˆåŠŸæŒ‡æ ‡

- [ ] ç”¨æˆ·å¯ä»¥æˆåŠŸé…ç½®1-30é¡µçš„æ•…äº‹
- [ ] ç”¨æˆ·å¯ä»¥é€‰æ‹©16:9æˆ–9:16é•¿å®½æ¯”
- [ ] ç³»ç»Ÿèƒ½è‡ªåŠ¨æå–2-5ä¸ªä¸»è¦è§’è‰²
- [ ] è§’è‰²åœ¨æ‰€æœ‰é¡µé¢ä¿æŒå¤–è§‚ä¸€è‡´æ€§ï¼ˆä¸€è‡´æ€§è¯„åˆ† > 90%ï¼‰
- [ ] ç”¨æˆ·å¯ä»¥é€‰æ‹©è‡ªåŠ¨æå–æˆ–æ‰‹åŠ¨è¾“å…¥è§’è‰²
- [ ] ä¸åŒé•¿å®½æ¯”çš„å›¾åƒæ„å›¾ä¼˜åŒ–æ•ˆæœæ˜æ˜¾
- [ ] æ”¯æŒè‡³å°‘3ç§è¯­è¨€ï¼ˆä¸­æ–‡ã€è‹±æ–‡ã€æ—¥æ–‡ï¼‰
- [ ] å›¾åƒç”ŸæˆæˆåŠŸç‡ > 95%
- [ ] è§’è‰²è¯†åˆ«å‡†ç¡®ç‡ > 85%
- [ ] é¡µé¢åŠ è½½æ—¶é—´ < 3ç§’
- [ ] ç§»åŠ¨ç«¯å®Œç¾é€‚é…ï¼ˆè‡ªåŠ¨é€‚åº”é•¿å®½æ¯”ï¼‰

---

## ğŸ”„ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

âœ… **å·²å®Œæˆ**: Phase 2.1 - UIç•Œé¢å¢å¼º
- âœ… é¡µæ•°é€‰æ‹©å™¨ç»„ä»¶ï¼ˆ1-30é¡µï¼Œé»˜è®¤6é¡µï¼‰
- âœ… é•¿å®½æ¯”é€‰æ‹©å™¨ç»„ä»¶ï¼ˆ16:9/9:16ï¼Œé»˜è®¤16:9ï¼‰
- âœ… å“åº”å¼è®¾è®¡å’Œç°ä»£åŒ–UI
- âœ… APIé›†æˆå’Œå‚æ•°ä¼ é€’

âœ… **å·²å®Œæˆ**: Phase 2.6 - å†…å®¹å®‰å…¨ä¼˜åŒ–
- âœ… Geminiæç¤ºè¯çº§åˆ«çš„å®‰å…¨æŒ‡å¯¼ï¼ˆæ•…äº‹åˆ†é¡µå’Œè§’è‰²æå–ï¼‰
- âœ… ç”¨æˆ·ç•Œé¢å®‰å…¨æç¤ºå’Œç¤ºä¾‹
- âœ… å‰ç«¯å®æ—¶å®‰å…¨è¯æ±‡è½¬æ¢
- âœ… å›¾åƒç”Ÿæˆå¢å¼ºå®‰å…¨æè¿°
- âœ… å¤šå±‚çº§å†…å®¹å®‰å…¨ä¿æŠ¤ä½“ç³»

**ç«‹å³å¼€å§‹**: Phase 2.5 - è§’è‰²æ™ºèƒ½ç³»ç»Ÿ
- å¼€å‘Geminiè§’è‰²æå–API
- åˆ›å»ºè§’è‰²æ¨¡å¼é€‰æ‹©ç•Œé¢
- å®ç°è§’è‰²ç®¡ç†å™¨ç»„ä»¶
- å®ç°è§’è‰²ç¼–è¾‘å™¨

**æœ¬å‘¨ç›®æ ‡**: å®Œæˆè§’è‰²ç®¡ç†ç³»ç»Ÿï¼Œå®ç°è§’è‰²ä¸€è‡´æ€§
**ä¸‹å‘¨ç›®æ ‡**: æµ‹è¯•å®Œæ•´æµç¨‹ï¼Œä¼˜åŒ–ç”¨æˆ·ä½“éªŒ

---

## ğŸ“ æœ€æ–°åŠŸèƒ½æ›´æ–°

### âœ… è‡ªåŠ¨æ ‡é¢˜ç”ŸæˆåŠŸèƒ½ (2025-01-01)

**åŠŸèƒ½æè¿°**: LLMè‡ªåŠ¨ä¸ºæ•…äº‹ç”Ÿæˆå¸å¼•äººçš„æ ‡é¢˜ï¼Œæ›¿æ¢å›ºå®šçš„"æ‚¨çš„æ•…äº‹ç»˜æœ¬"æ˜¾ç¤ºã€‚

**æŠ€æœ¯å®ç°**:
- æœåŠ¡ç«¯ï¼šåœ¨generateStoryPageså‡½æ•°ä¸­æ·»åŠ ç¬¬å››æ­¥"æ ‡é¢˜åˆ›ä½œ"
- æ ‡é¢˜ç”Ÿæˆè¦æ±‚ï¼šä½“ç°æ•…äº‹æ ¸å¿ƒä¸»é¢˜ã€é€‚åˆå„¿ç«¥ç»˜æœ¬ã€ä¸è¾“å…¥è¯­è¨€ä¸€è‡´
- è¿”å›ç»“æ„ï¼šæ–°å¢`storyTitle`å­—æ®µ
- å®¢æˆ·ç«¯ï¼šæ¥æ”¶å¹¶æ˜¾ç¤ºè‡ªåŠ¨ç”Ÿæˆçš„æ•…äº‹æ ‡é¢˜

**ç”¨æˆ·ä½“éªŒ**:
- æ¯ä¸ªæ•…äº‹éƒ½æœ‰ç‹¬ç‰¹çš„æ ‡é¢˜ï¼Œå¢å¼ºä¸ªäººåŒ–ä½“éªŒ
- æ ‡é¢˜ä¸æ•…äº‹å†…å®¹é«˜åº¦åŒ¹é…ï¼Œæå‡ä¸“ä¸šæ„Ÿ
- æ”¯æŒå¤šè¯­è¨€æ ‡é¢˜ç”Ÿæˆï¼Œä¿æŒè¯­è¨€ä¸€è‡´æ€§

**æ¥å£å˜æ›´**:
```javascript
// è¿”å›æ•°æ®ç»“æ„æ›´æ–°
{
  storyTitle: string,        // æ–°å¢ï¼šè‡ªåŠ¨ç”Ÿæˆçš„æ•…äº‹æ ‡é¢˜
  pages: Array,              // ç”Ÿæˆçš„é¡µé¢æ•°ç»„
  pageCount: number,         // å®é™…ç”Ÿæˆçš„é¡µæ•°
  mainCharacter: string,     // ä¸»è§’æè¿°
  characterType: string,     // è§’è‰²ç±»å‹
  success: boolean,          // ç”Ÿæˆæ˜¯å¦æˆåŠŸ
  generatedAt: string        // ç”Ÿæˆæ—¶é—´æˆ³
}
```

### âœ… è¾“å…¥é™åˆ¶å’ŒTokenä¼˜åŒ– (2025-01-01)

**è¾“å…¥é™åˆ¶åŠŸèƒ½**:
- 2000å­—ç¡¬é™åˆ¶ï¼Œè¶…å‡ºè‡ªåŠ¨æˆªæ–­
- å®æ—¶å­—æ•°è®¡æ•°å™¨ï¼ˆç°è‰²â†’æ©™è‰²â†’çº¢è‰²æ¸å˜æç¤ºï¼‰
- æ™ºèƒ½æç¤ºç³»ç»Ÿï¼ˆ1500å­—æé†’ï¼Œ1800å­—è­¦å‘Šï¼‰

**Tokenä¼˜åŒ–**:
- æ•…äº‹åˆ†é¡µç”Ÿæˆï¼š4,000 â†’ 8,000 tokens (æå‡100%)
- è§’è‰²æå–åŠŸèƒ½ï¼š1,000 â†’ 2,000 tokens (æå‡100%)
- æ”¯æŒæ›´é•¿æ•…äº‹å’Œ30é¡µç»˜æœ¬

**æŠ€æœ¯è§„æ ¼**:
- ä¸­æ–‡å­—ç¬¦ä¸Tokenæ¯”ä¾‹ä¼˜åŒ– (çº¦1.5:1)
- å®Œç¾åŒ¹é…Gemini 2.0 Flashçš„8kè¾“å‡ºèƒ½åŠ›
- æ”¯æŒçŸ­ç¯‡(6-10é¡µ)ã€ä¸­ç¯‡(10-20é¡µ)ã€é•¿ç¯‡(20-30é¡µ)ç»˜æœ¬

---

## ğŸ”¥ æœ€æ–°ä¿®å¤ (2025-01-01)

### âœ… é¡µé¢æ ‡é¢˜æ ¼å¼ä¼˜åŒ–

**æ”¹è¿›**: é¡µé¢å°æ ‡é¢˜æ ¼å¼ä» `ç¬¬ n é¡µ: xxx` æ”¹ä¸º `n. xxx`

**ä¼˜åŠ¿**:
- âœ… **æ›´ç®€æ´**: å‡å°‘ä¸å¿…è¦çš„æ–‡å­—
- âœ… **å›½é™…åŒ–**: é€‚åº”å¤šè¯­è¨€ç¯å¢ƒï¼Œä¸ä¾èµ–ç‰¹å®šè¯­è¨€æ ¼å¼
- âœ… **é€šç”¨æ€§**: `n. xxx` æ ¼å¼åœ¨å„ç§è¯­è¨€ä¸­éƒ½é€šç”¨
- âœ… **ç°ä»£åŒ–**: ç¬¦åˆç°ä»£UIè®¾è®¡è¶‹åŠ¿

**ç¤ºä¾‹å¯¹æ¯”**:
```
ä¿®æ”¹å‰: ç¬¬ 1 é¡µ: å°å…”å­å‡ºå‘
ä¿®æ”¹å: 1. å°å…”å­å‡ºå‘

ä¿®æ”¹å‰: ç¬¬ 18 é¡µ: å›åˆ°å®¶å›­  
ä¿®æ”¹å: 18. å›åˆ°å®¶å›­
```

**æŠ€æœ¯å®ç°**:
```javascript
// ä¿®æ”¹å‰
{page.title ? `ç¬¬ ${index + 1} é¡µ: ${page.title}` : `ç¬¬ ${index + 1} é¡µ`}

// ä¿®æ”¹å  
{page.title ? `${index + 1}. ${page.title}` : `${index + 1}.`}
```

### âœ… å°æ ‡é¢˜æ˜¾ç¤ºä¿®å¤

**é—®é¢˜**: ç”¨æˆ·åæ˜ åªæœ‰å‰é¢å‡ é¡µæœ‰å°æ ‡é¢˜ï¼Œåé¢çš„é¡µé¢åªæ˜¾ç¤º"ç¬¬ X é¡µ"è€Œä¸æ˜¯"ç¬¬ X é¡µ: å°æ ‡é¢˜"

**æ ¹å› **: å‰ç«¯æ•°æ®å¤„ç†è¿‡ç¨‹ä¸­ï¼Œ`title` å­—æ®µåœ¨ä»¥ä¸‹ä¸‰ä¸ªåœ°æ–¹ä¸¢å¤±ï¼š
1. åˆå§‹åŒ– `pagesWithImages` æ—¶ç¼ºå°‘ `title: page.title`
2. å›¾åƒç”ŸæˆæˆåŠŸå¤„ç†ä¸­ç¼ºå°‘ `title: page.title`  
3. å›¾åƒç”Ÿæˆå¤±è´¥å¤„ç†ä¸­ç¼ºå°‘ `title: page.title`

**ä¿®å¤å†…å®¹**:
- åœ¨ `client/src/api.js` ä¸­æ·»åŠ ç¼ºå¤±çš„ `title` å­—æ®µä¼ é€’
- åŒæ—¶ä¿®å¤äº† `sceneType` å’Œ `sceneCharacters` å­—æ®µçš„ä¼ é€’
- ç¡®ä¿æ‰€æœ‰é¡µé¢éƒ½èƒ½æ­£ç¡®æ˜¾ç¤º"ç¬¬ X é¡µ: å°æ ‡é¢˜"æ ¼å¼

**æŠ€æœ¯ç»†èŠ‚**:
```javascript
// ä¿®å¤å‰ï¼šç¼ºå°‘titleå­—æ®µ
const pagesWithImages = storyPages.map((page, index) => ({
  text: page.text,
  image: null,
  imagePrompt: page.imagePrompt,
  // ç¼ºå°‘: title: page.title
}));

// ä¿®å¤åï¼šæ·»åŠ å®Œæ•´å­—æ®µ
const pagesWithImages = storyPages.map((page, index) => ({
  text: page.text,
  title: page.title, // âœ… ä¿®å¤
  image: null,
  imagePrompt: page.imagePrompt,
  sceneType: page.sceneType, // âœ… ä¿®å¤
  sceneCharacters: page.sceneCharacters || [], // âœ… ä¿®å¤
}));
```

**éƒ¨ç½²çŠ¶æ€**: âœ… å·²éƒ¨ç½²è‡³ç”Ÿäº§ç¯å¢ƒ (https://ai-app-taskforce.web.app)

---

*æœ€åæ›´æ–°: 2025-01-01*
*çŠ¶æ€: Phase 1 âœ… å·²å®Œæˆï¼ŒPhase 2.1 âœ… å·²å®Œæˆï¼Œæ ‡é¢˜ç”Ÿæˆ âœ… å·²å®Œæˆï¼Œè¾“å…¥ä¼˜åŒ– âœ… å·²å®Œæˆ* 