# æµ‹è¯•æ–‡æ¡£

æœ¬ç›®å½•åŒ…å« Tale Draw å®¢æˆ·ç«¯åº”ç”¨çš„å•å…ƒæµ‹è¯•ã€‚

## ğŸ“ æµ‹è¯•ç»“æ„

```
test/
â”œâ”€â”€ setup.js                           # æµ‹è¯•ç¯å¢ƒé…ç½®
â”œâ”€â”€ README.md                          # æµ‹è¯•æ–‡æ¡£
â”œâ”€â”€ stateManager.test.js               # çŠ¶æ€ç®¡ç†æµ‹è¯•
â”œâ”€â”€ api.test.js                        # API æ¨¡å—æµ‹è¯•
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ ImagenModelSelector.test.js    # AIæ¨¡å‹é€‰æ‹©å™¨æµ‹è¯•
â”‚   â””â”€â”€ PageItem.test.js               # é¡µé¢é¡¹ç»„ä»¶æµ‹è¯•
â”œâ”€â”€ utils/
â”‚   â””â”€â”€ logger.test.js                 # æ—¥å¿—å·¥å…·æµ‹è¯•
â””â”€â”€ services/
    â””â”€â”€ StripeService.test.js          # Stripeæ”¯ä»˜æœåŠ¡æµ‹è¯•
```

## ğŸ§ª æµ‹è¯•è¦†ç›–èŒƒå›´

### æ ¸å¿ƒä¸šåŠ¡é€»è¾‘æµ‹è¯• (é«˜ä¼˜å…ˆçº§)
- **StateManager**: çŠ¶æ€æŒä¹…åŒ–ã€æ¢å¤ã€æ¸…ç†ã€æ•°æ®å®‰å…¨
- **APIæ¨¡å—**: å›¾åƒç”Ÿæˆã€é”™è¯¯å¤„ç†ã€å‚æ•°éªŒè¯
- **ç»„ä»¶æ ¸å¿ƒåŠŸèƒ½**: å›¾åƒæŸ¥çœ‹ã€ç¼–è¾‘åŠŸèƒ½ã€çŠ¶æ€ç®¡ç†

### å·¥å…·å‡½æ•°æµ‹è¯• (ä¸­ä¼˜å…ˆçº§)  
- **Logger**: å¼€å‘/ç”Ÿäº§ç¯å¢ƒæ—¥å¿—ã€æ•æ„Ÿæ•°æ®è¿‡æ»¤
- **ç»„ä»¶äº¤äº’**: ç”¨æˆ·äº¤äº’ã€äº‹ä»¶å¤„ç†ã€å¯è®¿é—®æ€§

### é›†æˆæœåŠ¡æµ‹è¯• (ä½ä¼˜å…ˆçº§)
- **æ”¯ä»˜æœåŠ¡**: Stripeé›†æˆã€é”™è¯¯å¤„ç†ã€å®‰å…¨æ€§

## ğŸš€ è¿è¡Œæµ‹è¯•

### è¿è¡Œæ‰€æœ‰æµ‹è¯•
```bash
cd client
npm test
```

### è¿è¡Œç‰¹å®šæµ‹è¯•æ–‡ä»¶
```bash
npm test -- stateManager.test.js
npm test -- components/PageItem.test.js
```

### è¿è¡Œæµ‹è¯•å¹¶æŸ¥çœ‹è¦†ç›–ç‡
```bash
npm test -- --coverage
```

### è¿è¡Œæµ‹è¯•å¹¶ç›‘å¬æ–‡ä»¶å˜åŒ–
```bash
npm test -- --watchAll
```

## ğŸ“Š æµ‹è¯•è¦†ç›–çš„åŠŸèƒ½ç‚¹

### StateManager æµ‹è¯•
- âœ… çŠ¶æ€ä¿å­˜å’Œæ¢å¤
- âœ… ç‰ˆæœ¬å…¼å®¹æ€§æ£€æŸ¥
- âœ… æ•°æ®è¿‡æœŸå¤„ç† (24å°æ—¶)
- âœ… æ•æ„Ÿæ•°æ®æ¸…ç†
- âœ… é”™è¯¯å¤„ç†å’Œå®¹é”™
- âœ… UIçŠ¶æ€ç®¡ç†
- âœ… è¾¹ç¼˜æƒ…å†µå¤„ç†

### API æ¨¡å—æµ‹è¯•
- âœ… å›¾åƒç”ŸæˆæˆåŠŸ/å¤±è´¥åœºæ™¯
- âœ… ä¸åŒåœºæ™¯ç±»å‹å¤„ç†
- âœ… å¤šç§å®½é«˜æ¯”æ”¯æŒ
- âœ… è¿›åº¦å›è°ƒå¤„ç†
- âœ… é”™è¯¯ç±»å‹è§£æ
- âœ… æ¨¡å‹å‚æ•°ä¼ é€’
- âœ… è§’è‰²æè¿°æ„å»º

### ç»„ä»¶æµ‹è¯•
- âœ… æ¸²æŸ“çŠ¶æ€ (æˆåŠŸ/å¤±è´¥/ç”Ÿæˆä¸­)
- âœ… ç”¨æˆ·äº¤äº’ (ç‚¹å‡»/ç¼–è¾‘/ä¿å­˜)
- âœ… å›¾åƒæŸ¥çœ‹å™¨åŠŸèƒ½
- âœ… é”®ç›˜å¿«æ·é”®
- âœ… é”™è¯¯æ˜¾ç¤ºå’Œå¤„ç†
- âœ… å¯è®¿é—®æ€§å±æ€§

### å·¥å…·å‡½æ•°æµ‹è¯•
- âœ… å¼€å‘/ç”Ÿäº§ç¯å¢ƒè¡Œä¸º
- âœ… æ•æ„Ÿæ•°æ®æ£€æµ‹å’Œè¿‡æ»¤
- âœ… æ—¥å¿—çº§åˆ«æ§åˆ¶
- âœ… æ€§èƒ½å’Œå®‰å…¨æ€§
- âœ… è¾¹ç¼˜æƒ…å†µå¤„ç†

## ğŸ›¡ï¸ æµ‹è¯•æœ€ä½³å®è·µ

### 1. Mock ç­–ç•¥
- **å¤–éƒ¨æœåŠ¡**: Firebaseã€Stripe ç­‰å¤–éƒ¨ä¾èµ–è¢«å®Œå…¨ mock
- **æµè§ˆå™¨ API**: localStorageã€window.openã€Canvas ç­‰è¢« mock
- **ç¯å¢ƒå˜é‡**: å¼€å‘/ç”Ÿäº§ç¯å¢ƒåˆ‡æ¢æµ‹è¯•

### 2. æ•°æ®å®‰å…¨
- æµ‹è¯•æ•æ„Ÿæ•°æ®è¿‡æ»¤æœºåˆ¶
- éªŒè¯ç”Ÿäº§ç¯å¢ƒä¸æ³„éœ²è°ƒè¯•ä¿¡æ¯
- ç¡®ä¿é”™è¯¯ä¿¡æ¯ä¸åŒ…å«æ•æ„Ÿå†…å®¹

### 3. é”™è¯¯å¤„ç†
- ç½‘ç»œé”™è¯¯ã€API å¤±è´¥åœºæ™¯
- æ— æ•ˆè¾“å…¥å’Œè¾¹ç¼˜æƒ…å†µ
- ç”¨æˆ·å–æ¶ˆæ“ä½œ

### 4. æ€§èƒ½è€ƒè™‘
- å¤§æ•°æ®é‡å¤„ç†æµ‹è¯•
- é¢‘ç¹æ“ä½œæ€§èƒ½æµ‹è¯•
- å†…å­˜æ³„æ¼é¢„é˜²

## ğŸ”§ æµ‹è¯•é…ç½®

### setup.js é…ç½®å†…å®¹
- Jest DOM æ‰©å±•
- localStorage mock
- Firebase mock
- Canvas/Image API mock
- æ§åˆ¶å°è¾“å‡ºmock

### Mock è¯´æ˜
```javascript
// ç¤ºä¾‹ï¼šlocalStorage mock
const localStorageMock = {
  getItem: jest.fn(),
  setItem: jest.fn(),
  removeItem: jest.fn(),
  clear: jest.fn(),
};
global.localStorage = localStorageMock;
```

## ğŸ“ˆ æŒç»­æ”¹è¿›

### å·²å®ç°
- âœ… æ ¸å¿ƒä¸šåŠ¡é€»è¾‘å®Œæ•´æµ‹è¯•è¦†ç›–
- âœ… é”™è¯¯åœºæ™¯å’Œè¾¹ç¼˜æƒ…å†µæµ‹è¯•
- âœ… å®‰å…¨æ€§å’Œæ€§èƒ½æµ‹è¯•
- âœ… å¯è®¿é—®æ€§æµ‹è¯•

### å¾…æ‰©å±•
- ğŸ”„ ç«¯åˆ°ç«¯æµ‹è¯• (E2E)
- ğŸ”„ è§†è§‰å›å½’æµ‹è¯•
- ğŸ”„ æ€§èƒ½åŸºå‡†æµ‹è¯•
- ğŸ”„ å¤šæµè§ˆå™¨å…¼å®¹æ€§æµ‹è¯•

## ğŸ› æµ‹è¯•å¤±è´¥æ’æŸ¥

### å¸¸è§é—®é¢˜
1. **Mock æœªç”Ÿæ•ˆ**: ç¡®ä¿ mock åœ¨ `beforeEach` ä¸­æ­£ç¡®è®¾ç½®
2. **å¼‚æ­¥æµ‹è¯•å¤±è´¥**: ä½¿ç”¨ `async/await` æˆ– `waitFor`
3. **DOM æµ‹è¯•é—®é¢˜**: æ£€æŸ¥ `@testing-library/jest-dom` é…ç½®

### è°ƒè¯•æŠ€å·§
```bash
# è¿è¡Œå•ä¸ªæµ‹è¯•å¹¶æ˜¾ç¤ºè¯¦ç»†è¾“å‡º
npm test -- --verbose stateManager.test.js

# è¿è¡Œæµ‹è¯•å¹¶ä¿æŒè¿›ç¨‹æ´»è·ƒä»¥ä¾¿è°ƒè¯•
npm test -- --runInBand --no-cache
```

## ğŸ“ ç¼–å†™æ–°æµ‹è¯•

### æ–‡ä»¶å‘½å
- æµ‹è¯•æ–‡ä»¶: `*.test.js`
- æ”¾ç½®ä½ç½®: å¯¹åº” `src/` ç»“æ„çš„ `test/` ç›®å½•

### æµ‹è¯•ç»“æ„
```javascript
describe('åŠŸèƒ½æ¨¡å—å', () => {
  beforeEach(() => {
    // æµ‹è¯•å‰å‡†å¤‡
  });

  describe('å­åŠŸèƒ½', () => {
    it('should å…·ä½“è¡Œä¸ºæè¿°', () => {
      // æµ‹è¯•ä»£ç 
    });
  });
});
```

### æ–­è¨€ç¤ºä¾‹
```javascript
// åŸºæœ¬æ–­è¨€
expect(result).toBe(expected);
expect(result).toEqual(expectedObject);

// DOM æ–­è¨€
expect(element).toBeInTheDocument();
expect(element).toHaveClass('className');

// å‡½æ•°è°ƒç”¨æ–­è¨€
expect(mockFunction).toHaveBeenCalledWith(param);
expect(mockFunction).toHaveBeenCalledTimes(1);
```

---

**ç»´æŠ¤è€…**: Tale Draw å¼€å‘å›¢é˜Ÿ  
**æœ€åæ›´æ–°**: 2025-07-11