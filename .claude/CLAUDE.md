# 工程开发规范 (Engineering Development Rules)
为确保项目代码质量、可维护性和安全性，所有贡献者应遵循以下规范。

## 0. 通用规范
- Agent所有执行都应该仔细思考，不要盲目执行
- Agent所有执行应该持续工作，不要中途停止，直到完成任务
- 可通过npx运行firebase CLI

## 1. 编码规范 
- **代码风格** 遵循项目现有代码风格。保持一致性，提高代码可读性。
- **命名** 使用清晰、有意义的英文名称命名变量、函数和组件。
- **函数/组件** 保持函数和组件的单一职责和简洁性。一个函数只做一件事。
- **国际化** 应用界面(UI)文本和日志信息必须使用英文。
- **字符编码** 所有HTTP通信的 `Content-Type` 头必须明确指定 `charset=UTF-8`，以避免编码问题。

## 2. 自动化测试
- **单元测试** 所有新增的核心业务逻辑和工具函数必须附带单元测试。
- **eslint** 使用eslint检查代码规范，确保代码质量。
- **端到端测试** 对于关键用户流程（如用户认证、绘本生成），应编写或更新端到端测试，确保核心功能稳定。
- **测试覆盖率** 鼓励逐步提高测试覆盖率，但不强制具体指标。质量优先。

## 3. 可复用性与可维护性
- **模块化** 提倡模块化设计。将通用功能封装成可复用的组件或服务。
- **文档** 为公共API、复杂算法或业务逻辑添加必要的文档注释。
- **无用代码** 及时移除不再使用的代码、特性开关或临时方案，保持代码库整洁。
- **核心代码保护** 对于已经实现并经过测试的核心代码（尤其是提示词等模块），不应轻易删除。删除前必须经过仔细审查和确认，删除后需立即进行回归测试，并通过后同步更新文档。

## 4. 性能
- **API效率** 优化后端API调用，例如使用批量处理减少请求次数。
- **前端性能** 关注前端性能，包括代码分割、资源压缩和智能缓存策略，媒体资源避免重复下载。
- **资源管理** 避免内存泄漏，及时清理不再使用的资源，特别是在云函数中。

## 5. 安全性
- **输入验证** 对所有来自客户端或外部服务的输入进行严格验证和清理。
- **内容安全** 严格遵守项目的内容安全规范，确保生成内容对儿童友好。
- **依赖管理** 定期审查和更新项目依赖，避免引入存在已知漏洞的第三方库。
- **权限控制** 遵循最小权限原则，确保API和数据访问受到严格的认证和授权控制。