# Tale Draw Functions æµ‹è¯• Makefile
# æä¾›ä¾¿æ·çš„æµ‹è¯•å‘½ä»¤

# é¢œè‰²å®šä¹‰
GREEN := \033[0;32m
YELLOW := \033[0;33m
RED := \033[0;31m
NC := \033[0m # No Color

.PHONY: help install test test-unit test-integration test-performance test-ci test-all test-watch test-coverage clean lint emulator-start emulator-stop

# é»˜è®¤ç›®æ ‡
help:
	@echo "$(GREEN)Tale Draw Functions æµ‹è¯•å‘½ä»¤$(NC)"
	@echo "=================================="
	@echo ""
	@echo "$(YELLOW)å®‰è£…å’Œè®¾ç½®:$(NC)"
	@echo "  make install          - å®‰è£…æµ‹è¯•ä¾èµ–"
	@echo "  make clean            - æ¸…ç†ä¾èµ–å’Œç¼“å­˜"
	@echo ""
	@echo "$(YELLOW)æµ‹è¯•å‘½ä»¤:$(NC)"
	@echo "  make test             - è¿è¡Œæ‰€æœ‰æµ‹è¯•"
	@echo "  make test-unit        - è¿è¡Œå•å…ƒæµ‹è¯• (~30ç§’)"
	@echo "  make test-integration - è¿è¡Œé›†æˆæµ‹è¯• (~2åˆ†é’Ÿ)"
	@echo "  make test-performance - è¿è¡Œæ€§èƒ½æµ‹è¯• (~5åˆ†é’Ÿ)"
	@echo "  make test-ci          - è¿è¡ŒCIæµ‹è¯• (å•å…ƒ+é›†æˆ)"
	@echo "  make test-all         - è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶"
	@echo "  make test-watch       - ç›‘è§†æ¨¡å¼è¿è¡Œæµ‹è¯•"
	@echo "  make test-coverage    - è¿è¡Œè¦†ç›–ç‡æµ‹è¯•"
	@echo ""
	@echo "$(YELLOW)å·¥å…·å‘½ä»¤:$(NC)"
	@echo "  make lint             - ä»£ç é£æ ¼æ£€æŸ¥"
	@echo "  make emulator-start   - å¯åŠ¨Firebaseæ¨¡æ‹Ÿå™¨"
	@echo "  make emulator-stop    - åœæ­¢Firebaseæ¨¡æ‹Ÿå™¨"
	@echo ""

# å®‰è£…ä¾èµ–
install:
	@echo "$(YELLOW)ğŸ“¥ å®‰è£…æµ‹è¯•ä¾èµ–...$(NC)"
	npm install
	@echo "$(GREEN)âœ… ä¾èµ–å®‰è£…å®Œæˆ$(NC)"

# æ¸…ç†
clean:
	@echo "$(YELLOW)ğŸ§¹ æ¸…ç†ä¾èµ–å’Œç¼“å­˜...$(NC)"
	rm -rf node_modules package-lock.json
	npm cache clean --force
	@echo "$(GREEN)âœ… æ¸…ç†å®Œæˆ$(NC)"

# è¿è¡Œæ‰€æœ‰æµ‹è¯•
test:
	@echo "$(YELLOW)ğŸ§ª è¿è¡Œæ‰€æœ‰æµ‹è¯•...$(NC)"
	npm test

# å•å…ƒæµ‹è¯•
test-unit:
	@echo "$(YELLOW)ğŸƒâ€â™‚ï¸ è¿è¡Œå•å…ƒæµ‹è¯•...$(NC)"
	npm run test:unit
	@echo "$(GREEN)âœ… å•å…ƒæµ‹è¯•å®Œæˆ$(NC)"

# é›†æˆæµ‹è¯•
test-integration:
	@echo "$(YELLOW)ğŸ”— è¿è¡Œé›†æˆæµ‹è¯•...$(NC)"
	@echo "$(YELLOW)âš ï¸ ç¡®ä¿Firebaseæ¨¡æ‹Ÿå™¨æ­£åœ¨è¿è¡Œ$(NC)"
	npm run test:integration
	@echo "$(GREEN)âœ… é›†æˆæµ‹è¯•å®Œæˆ$(NC)"

# æ€§èƒ½æµ‹è¯•
test-performance:
	@echo "$(YELLOW)âš¡ è¿è¡Œæ€§èƒ½æµ‹è¯•...$(NC)"
	npm run test:performance
	@echo "$(GREEN)âœ… æ€§èƒ½æµ‹è¯•å®Œæˆ$(NC)"

# CIæµ‹è¯•
test-ci:
	@echo "$(YELLOW)ğŸš€ è¿è¡ŒCIæµ‹è¯• (å•å…ƒ+é›†æˆ)...$(NC)"
	npm run test:ci
	@echo "$(GREEN)âœ… CIæµ‹è¯•å®Œæˆ$(NC)"

# å®Œæ•´æµ‹è¯•
test-all:
	@echo "$(YELLOW)ğŸŒŸ è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶...$(NC)"
	npm run test:all
	@echo "$(GREEN)âœ… å®Œæ•´æµ‹è¯•å®Œæˆ$(NC)"

# ç›‘è§†æ¨¡å¼
test-watch:
	@echo "$(YELLOW)ğŸ‘€ å¯åŠ¨ç›‘è§†æ¨¡å¼...$(NC)"
	npm run test:watch

# è¦†ç›–ç‡æµ‹è¯•
test-coverage:
	@echo "$(YELLOW)ğŸ“Š è¿è¡Œè¦†ç›–ç‡æµ‹è¯•...$(NC)"
	npm run test:coverage
	@echo "$(GREEN)âœ… è¦†ç›–ç‡æµ‹è¯•å®Œæˆ$(NC)"

# ä»£ç æ£€æŸ¥
lint:
	@echo "$(YELLOW)ğŸ” æ£€æŸ¥ä»£ç é£æ ¼...$(NC)"
	npm run lint
	@echo "$(GREEN)âœ… ä»£ç æ£€æŸ¥å®Œæˆ$(NC)"

# å¯åŠ¨æ¨¡æ‹Ÿå™¨
emulator-start:
	@echo "$(YELLOW)ğŸš€ å¯åŠ¨Firebaseæ¨¡æ‹Ÿå™¨...$(NC)"
	cd .. && firebase emulators:start --only functions,firestore,storage

# åœæ­¢æ¨¡æ‹Ÿå™¨
emulator-stop:
	@echo "$(YELLOW)ğŸ›‘ åœæ­¢Firebaseæ¨¡æ‹Ÿå™¨...$(NC)"
	cd .. && firebase emulators:exec --only functions 'exit 0'

# å¿«é€Ÿå¼€å§‹ï¼ˆå®‰è£…+å•å…ƒæµ‹è¯•ï¼‰
quick-start: install test-unit
	@echo "$(GREEN)ğŸ‰ å¿«é€Ÿå¼€å§‹å®Œæˆï¼$(NC)"

# å®Œæ•´è®¾ç½®ï¼ˆå®‰è£…+å®Œæ•´æµ‹è¯•ï¼‰
full-setup: install test-all
	@echo "$(GREEN)ğŸ‰ å®Œæ•´è®¾ç½®å®Œæˆï¼$(NC)" 